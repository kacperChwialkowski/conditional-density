% LaTeX file for a 1 page document
\documentclass[10pt]{article}
\usepackage{amssymb,amsmath}
\usepackage{amsthm}

\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}
\newtheorem{Theorem}{Theorem}
\newtheorem{example}{Example}
\newtheorem{statement}{Statement}
\newtheorem{corollary}{Corollary}
\newtheorem{test}{Test}
\newtheorem{proposition}{Proposition}


\title{Conditional density estimation}


\begin{document}
\maketitle

\begin{abstract}
\end{abstract}

\section{One approach}
Here we will assume that the conditional density can be written as 
\begin{equation}
p_0(x|y) = q(x,y)exp(f(x,y) - A(T))
\end{equation} 
By Proposition 1 from the paper [Inf] quite a few conditional densities can be approximated by functions of this type. We need to redefine Fisher divergence   
\begin{align}
J(p_0|p) &= \int \left( \int p_0(x|y) \parallel \frac{\partial  f_0(x,y)} {\partial x} -\frac{\partial  f(x,y)} {\partial x} \parallel^2 \right )p(y) dx dy  \\
&=  \int  \parallel \frac{\partial  f_0(x,y)} {\partial x} -\frac{\partial  f(x,y)} {\partial x} \parallel^2 p_0(x,y) dx dy \\
&=  \int   \left \langle f-f_0,\frac{\partial  k( (x,y), \cdot)} {\partial x} \right \rangle^2    p_0(x,y) dx dy
\end{align}
The reasoning for the Theorem 3 follows. For the sake of simplicity I assume that $x$ is one dimensional. In particular we have that 
\begin{equation}
 C := \int  p_0(x,y) \frac{\partial  k( (x,y), \cdot)} {\partial x} \otimes \frac{\partial  k( (x,y), \cdot)} {\partial x} dx dy
\end{equation}
and 
\begin{equation}
 J(f) := J(p_0|p) = \langle (f -f_0),C(f -f_0) \rangle.
\end{equation}
Also 
\begin{equation}
 J(f) = \langle f,Cf \rangle + \langle f,\xi \rangle + Const
\end{equation}
but $\xi$ is looks sightly different. Using the fact that
\begin{equation}
 \frac{\partial  f(x,y)} {\partial x}  = \frac{\partial  \log p_0(x|y)}{\partial x} - \frac{\partial  \log q(x,y)}{\partial x}
\end{equation}

\begin{align}
&\langle f,Cf_0 \rangle \\
=& \int p_0(x,y) \frac{\partial  f(x,y)} {\partial x} \frac{\partial  f_0(x,y)} {\partial x} dx dy \\
=& \int p_0(x,y) \frac{\partial  f(x,y)} {\partial x} \frac{\partial  \log p_0(x|y)}{\partial x} - \int p_0(x,y) \frac{\partial  f(x,y)} {\partial x} \frac{\partial  \log q(x,y)}{\partial x} \\
=&  \int   \left(\int  \frac{\partial  f(x,y)} {\partial x} \frac{\partial  p_0(x|y)}{\partial x} dx \right) p(y) dy 
- \int p_0(x,y) \frac{\partial  f(x,y)} {\partial x} \frac{\partial  \log q(x,y)}{\partial x} dx dy \\
\end{align}
Now the first inner  integral (check that it exists !) will be reduced by integration by parts  
\begin{align}
\int&  \frac{\partial  f(x,y)} {\partial x} \frac{\partial  p_0(x|y)}{\partial x} dx \\
&=  \frac{\partial f(x,y)} {\partial x} p_0(x|y) \mid_{-\infty}^{\infty} - \int \frac{\partial f(x,y)} {\partial x}^2 p_0(x|y)
\end{align}
we assume that $\frac{\partial f(x,y)} {\partial x} p_0(x|y) \mid_{-\infty}^{\infty} =0$, plug in and have 
\begin{align}
&\langle f,Cf_0 \rangle \\
=&  \int   \frac{\partial f(x,y)} {\partial x}^2  p_0(x,y) dx dy - \int p_0(x,y) \frac{\partial  f(x,y)} {\partial x} \frac{\partial  \log q(x,y)}{\partial x} dx dy \\
=& -\int p_0(x,y) \left \langle f , \frac{\partial  k( (x,y), \cdot)} {\partial x}^2+ \frac{\partial  k( (x,y), \cdot)} {\partial x}\frac{\partial  \log q(x,y)}{\partial x} \right \rangle
\end{align}
so 
\begin{equation}
 \xi =-\int p_0(x,y)  \left( \frac{\partial  k( (x,y), \cdot)} {\partial x}^2+ \frac{\partial  k( (x,y), \cdot)} {\partial x}\frac{\partial  \log q(x,y)}{\partial x} \right)
\end{equation}
We don't really care about the third since it is constant.


\section{Other option}

Consider a function $T(x,y)$ which is a bilinear form in some Hilbert space  $T(x,y) = \langle \phi(x), T \phi(y) \rangle $, where mapping $\phi$ and is an injection to some RKHS. Consider the following function
\begin{equation}
f(x,y) = q(x,y)exp(T(x,y) - A(T)),
\end{equation}
such that for all 
\begin{equation}
\label{eq:toOne}
 \int f(x,y) dx = 1. 
\end{equation}
We are thinking of $f$ as a conditional density. We consider Fisher divergence of $f$ and the true conditional density $f_0$, we suppose that $g_0$ is a true density associated with $f_0$ 
\begin{equation}
J(f_0|f) = \int g_0(x,y) \parallel \frac{\partial \log f_0(x,y)} {\partial x} -\frac{\partial \log f(x,y)} {\partial x} \parallel^2 dx dy  
\end{equation}

\begin{lemma}
There exists an operator $C$ such that
\begin{equation}
J(T):= J(f_0|f) = \rangle (T-T_0),C(T-T_0) \langle
\end{equation} 
\end{lemma}

\begin{proof}
\begin{align}
\int g_0(x,y) \parallel \frac{\partial \log f_0(x,y)} {\partial x} -\frac{\partial \log f(x,y)} {\partial x} \parallel^2 dx dy \\
\end{align} 
\end{proof}

\end{document}
